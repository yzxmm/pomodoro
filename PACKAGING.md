# 打包指南 (Packaging Guide)

本文档介绍如何将 Pomodoro Widget 打包为 Windows 可执行文件 (.exe)。

## 1. 环境准备

确保你已经安装了 Python 3.12+ 和项目依赖。
此外，你需要安装 `pyinstaller`：

```bash
pip install pyinstaller
```

## 2. 快速打包

项目根目录下已经配置好了 `main.spec` 文件，直接运行以下命令即可打包：

```bash
pyinstaller main.spec
```
或者直接运行 `build.bat` 脚本。

打包过程可能需要几分钟。完成后，你会看到 `dist/` 文件夹。

## 3. 输出文件

打包成功后，可执行文件位于：
`dist/pomodoro_widget.exe`

## 4. 打包策略说明 (重要)

我们采用了 **全量打包** 策略，以确保用户即使在离线状态下也能获得完整的体验（包括生日语音和节日语音）。

### ✅ 包含的内容
- **核心代码**: 所有 `.py` 文件及依赖库。
- **界面资源**: `assets/` 文件夹下的所有图片。
- **完整语音库**: `sounds/` 文件夹下的**所有内容**，包括：
  - 基础语音 (`start.mp3` 等)
  - 随机语音库 (`sounds/random/...`)
  - 节日语音库 (`sounds/holidays/...`，如生日语音)

### ❌ 排除的内容
- **云端缓存**: `cloud/` 文件夹不会被打包。
- **Git 文件**: `.git` 目录不会被打包。

## 5. 配置文件说明 (`main.spec`)

`main.spec` 是 PyInstaller 的配置文件，主要处理了以下事项：

- **资源包含**: 自动将 `assets` 和 `sounds` 整个文件夹打包进 exe 中。
- **隐藏控制台**: 设置 `console=False`，运行时不会弹出黑色命令行窗口。

```python
# 关键配置片段
datas = [
    ('assets', 'assets'),
    ('sounds', 'sounds'), # 递归包含 sounds 下的所有文件
]
```

## 6. 测试与验证

打包完成后，建议进行以下测试：

1. **启动测试**: 双击 `pomodoro_widget.exe`，确保程序能正常启动。
2. **云端下载测试**: 
   - 启动程序后，检查是否会自动触发云端下载（如果本地没有 `sounds/random` 且网络正常）。
   - 观察是否能在 `sounds/random` 下生成新的语音文件。
3. **保底测试**: 在未联网情况下，确保基础的 5 条语音能正常播放。

## 7. 运行时依赖注意

### Git
如果启用了云端资源更新功能（通过 `settings.json` 中的 `sounds_update_url` 指向 Git 仓库），**用户的电脑上必须安装 Git 并配置到环境变量中**。

程序会在启动时检测 `git` 命令是否存在：
- 如果存在，则尝试拉取/克隆更新。
- 如果不存在，会跳过更新步骤，直接进入程序。

因此，如果你分发此程序给普通用户，请告知他们如果需要自动更新资源，需要安装 Git。否则程序将仅使用打包时的内置资源。
